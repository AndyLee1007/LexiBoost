<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LexiBoost - English Vocabulary Learning</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Login/User Selection -->
        <div id="login-screen" class="screen">
            <h1>üöÄ LexiBoost</h1>
            <p>Learn English vocabulary with fun quizzes!</p>
            
            <div class="login-form">
                <input type="text" id="username" placeholder="Enter your name (or leave blank for Guest)" maxlength="20">
                <button class="primary-btn" onclick="loginUser()">Start Learning</button>
            </div>
            
            <div class="features">
                <div class="feature">üìö Configurable questions per session</div>
                <div class="feature">üß† Smart repetition system</div>
                <div class="feature">üìä Track your progress</div>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div id="dashboard-screen" class="screen hidden">
            <div class="header">
                <h2>Welcome, <span id="user-name"></span>!</h2>
                <div class="dashboard-actions">
                    <button onclick="showImportDictionaryScreen()" class="secondary-btn">üìö Import Dictionary</button>
                    <button onclick="showImportWrongbookScreen()" class="secondary-btn">üìã Import Wrongbook</button>
                    <button onclick="runSelfTest()" class="secondary-btn">üß™ Run Self-Test</button>
                </div>
            </div>

            <div class="dictionaries-section">
                <h3>Your Dictionaries</h3>
                <div id="dictionaries-loading" class="loading-text">Loading dictionaries...</div>
                <div id="dictionaries-list" class="dictionaries-list">
                    <!-- Dictionaries will be populated dynamically -->
                </div>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="screen hidden">
            <div class="quiz-header">
                <div class="progress-info">
                    <span>Question <span id="question-number">1</span> of <span id="total-questions">50</span></span>
                    <div class="progress-bar">
                        <div id="progress-fill" class="progress-fill"></div>
                    </div>
                </div>
                <div class="score-display">
                    Score: <span id="current-score">0</span>
                </div>
            </div>

            <!-- Loading State -->
            <div id="question-loading" class="loading-container hidden">
                <div class="loading-spinner"></div>
                <div class="loading-text">Loading next question...</div>
            </div>

            <div id="question-content" class="question-content">
                <div class="sentence-display">
                    <p id="sentence-text"></p>
                </div>
                
                <div class="question-prompt">
                    <div class="question-en">What does "<span id="target-word"></span>" mean?</div>
                    <div class="question-zh" id="question-zh">"<span id="target-word-zh"></span>"ÁöÑÊÑèÊÄùÊòØ‰ªÄ‰πàÔºü</div>
                </div>

                <div class="choices" id="answer-choices">
                    <!-- Choices will be populated dynamically -->
                </div>

                <div class="submit-button-container">
                    <button id="submit-answer" onclick="submitAnswer()" class="primary-btn" disabled>Submit Answer</button>
                </div>
                
                <!-- Result display area (initially hidden) -->
                <div id="result-display" class="result-display hidden">
                    <div id="explanation" class="explanation"></div>
                    <div id="auto-progress-message" class="auto-progress-message" style="display: none;"></div>
                    <div class="next-button-container">
                        <button id="next-question-btn" onclick="nextQuestion()" class="primary-btn">Next Question</button>
                    </div>
                </div>
            </div>
        </div>


        <!-- Session Complete Screen -->
        <div id="complete-screen" class="screen hidden">
            <div class="complete-content">
                <h2 id="complete-title">üéâ Session Complete!</h2>
                <div id="complete-message" class="complete-message"></div>
                <div id="final-stats-container" class="final-stats">
                    <div class="stat">Questions: <span id="final-questions">0</span></div>
                    <div class="stat">Correct: <span id="final-correct">0</span></div>
                    <div class="stat">Score: <span id="final-score">0</span></div>
                    <div class="stat">Accuracy: <span id="final-accuracy">0%</span></div>
                </div>
                <button onclick="returnToDashboard()" class="primary-btn">Return to Dashboard</button>
            </div>
        </div>

        <!-- Import Dictionary Screen -->
        <div id="import-dictionary-screen" class="screen hidden">
            <div class="import-content">
                <h2>üìö Import New Dictionary</h2>
                
                <div class="dictionary-info">
                    <label for="dictionary-name">Dictionary Name:</label>
                    <input type="text" id="dictionary-name" placeholder="Enter dictionary name" maxlength="50">
                    
                    <label for="dictionary-description">Description (optional):</label>
                    <textarea id="dictionary-description" placeholder="Enter description" rows="3"></textarea>
                </div>
                
                <div class="file-upload">
                    <label for="dictionary-csv-file">Upload CSV file:</label>
                    <input type="file" id="dictionary-csv-file" accept=".csv">
                    <button onclick="uploadDictionaryCSV()">Import Dictionary</button>
                </div>
                
                <div class="csv-format">
                    <h4>CSV Format:</h4>
                    <pre>word,category,level
apple,fruit,k12
beautiful,adjective,intermediate
computer,technology,advanced</pre>
                    <p><small>Note: Only 'word' column is required. Category and level are optional.</small></p>
                </div>
                
                <button onclick="returnToDashboard()" class="secondary-btn">Back to Dashboard</button>
            </div>
        </div>

        <!-- Import Wrongbook Screen -->
        <div id="import-wrongbook-screen" class="screen hidden">
            <div class="import-content">
                <h2>üìã Import Wrongbook</h2>
                <p>Import words into an existing dictionary and mark them for review:</p>
                
                <div class="dictionary-selection">
                    <label for="wrongbook-dictionary-select">Select Dictionary:</label>
                    <select id="wrongbook-dictionary-select">
                        <option value="">Loading dictionaries...</option>
                    </select>
                </div>
                
                <div class="file-upload">
                    <label for="wrongbook-csv-file">Upload CSV file:</label>
                    <input type="file" id="wrongbook-csv-file" accept=".csv">
                    <button onclick="uploadWrongbookCSV()">Import Wrongbook</button>
                </div>
                
                <div class="csv-format">
                    <h4>CSV Format:</h4>
                    <pre>word,category,level
difficult,adjective,intermediate
complicated,adjective,advanced
struggle,verb,intermediate</pre>
                    <p><small>Words will be added to the selected dictionary and marked for review.</small></p>
                </div>
                
                <button onclick="returnToDashboard()" class="secondary-btn">Back to Dashboard</button>
            </div>
        </div>

        <!-- Old Import Screen (keeping for compatibility) -->
        <div id="import-screen" class="screen hidden">
            <div class="import-content">
                <h2>Import Wrongbook Words</h2>
                <p>Upload a CSV file with words and definitions:</p>
                <div class="file-upload">
                    <input type="file" id="csv-file" accept=".csv">
                    <button onclick="uploadCSV()">Upload CSV</button>
                </div>
                <div class="csv-format">
                    <h4>CSV Format:</h4>
                    <pre>word,definition
happy,feeling or showing pleasure
sad,feeling or showing sorrow</pre>
                </div>
                <button onclick="returnToDashboard()" class="secondary-btn">Back to Dashboard</button>
            </div>
        </div>

        <!-- Self-Test Screen -->
        <div id="selftest-screen" class="screen hidden">
            <div class="selftest-content">
                <h2>System Self-Test</h2>
                <div id="test-results"></div>
                <button onclick="returnToDashboard()" class="secondary-btn">Back to Dashboard</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>